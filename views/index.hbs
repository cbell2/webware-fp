<body style="background: #e8e8e8">

<nav class="shadow navbar sticky-top navbar-dark navbar-expand-md" style=" position: sticky; top: 0; background-image: linear-gradient(to right, #02a6ff, #00e9ff) !important;">
    <a class="navbar-brand" href="/" style="color:white; font-size: 30px; font-weight: bold; text-shadow: 2px 4px 3px rgba(0,0,0,0.3);">Yeat</a>
    <button class="navbar-toggler" style="border-color: white;" type="button" data-toggle="collapse" data-target="#navbarText"
            aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">

        <ul class="navbar-nav mr-auto">
            <input class="form-control mr-sm-2" style="width: 400px" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" style="color: white; border-color: white;" type="submit">Search</button>
        </ul>
        <span class="navbar-text">
        <a href="/logout" class="nav-link" style="color: white; text-decoration: underline; font-weight: bold; font-size: 15px;"
        >Log Out</a>
      </span>
        <span class="navbar-text">
        <a id="loginA" class="nav-link" data-toggle="modal" data-target="#loggedInModal" style="color: white; text-decoration: underline; font-weight: bold; font-size: 15px"
           href="#">My Events</a>
      </span>
    </div>
</nav>

<div class="col-9" style="height: 100%; float: left; padding-right: 0px; padding-left: 0px;">
    <button id="addevent" onclick=goToCreate() style="width:55px;border-radius:50%;color:white;background-color:#00e9ff;font-size:30px;font-weight:600;text-align:center;display:inline-block;margin: 4px 2px;padding:2px;cursor:pointer">+</button>
    <div id="owned" style="display: none">
        {{#each eventsOwned}}
            <div class="card shadow" style="width: 100%; margin-top: 10px; display: inline-block; margin-bottom: 10px;">
                <div class="col-3" style="float: left; padding-left: 0px; padding-right: 0px">
                    <img class="card-img-top" src="{{this.image}}" alt="Card image cap" style="width: 100%; height: 100%;">
                </div>
                <div class="col-10" >
                    <div class="card-body" style="padding: 0px;">
                        <h5 class="card-title">{{this.name}}</h5>
                        <p class="card-text">{{this.description}}</p>
                    </div>
                </div>
                <div class="col-3" style="position: absolute; top: 70px; right: -85px">
                    <a href="#" class="btn btn-danger">Close Event</a>
                    <!-- <a href="#" class="btn btn-primary">{{this.date}}</a> -->
                    <h5 style="color: #717171; position: absolute; right: 30px; bottom: 10px">Currently: {{this.currentAttendance}} / {{this.maxAttendance}} Attendees</h5>
                    <i class="fas fa-check-square" style="color: red; font-size: 25px; position: absolute; top: 1px; right: 20px; width: 20px; height: 20px;"></i>
                </div>
            </div>

            <ul id="{{this._id}}" class="list-group eventId" style"margin-top: 10px">
                {{#each this.requested}}
                    <li class="list-group-item">
                        <p style="font-weight:600; cursor:pointer" onclick="showModal({{JSONstringify this}})"> {{this.name}}</p> would like to attend!
                        <a id="{{this._id}}" href="#" onclick="acceptRequest(this)" class="btn btn-success">Accept</a>
                        <a id="{{this._id}}" href="#" onclick="declineRequest(this)" class="btn btn-danger">Decline</a>
                    </li>
                {{/each}}
                {{#each this.attending}}
                    <li class="list-group-item">
                        {{this.name}} is attending your event.
                    </li>
                {{/each}}
            </ul>
        {{/each}}
    </div>

    <div id="attending" style="display: none">
        {{#each eventsAttending}}
            <div class="card shadow" style="width: 100%; margin-top: 10px; display: inline-block; margin-bottom: 10px;">
                <div class="row">
                    <div class="col-3" style="float: left; padding-left: 0px; padding-right: 0px">
                        <img class="card-img-top" src={{this.image}} alt="Card image cap" style="width: 100%; height: 100%;">
                    </div>
                    <div class="col-6" >
                        <div class="card-body" style="padding: 0px; float: left">
                            <h5 class="card-title">{{this.name}}</h5>
                            <p class="card-text">{{this.description}}</p>
                        </div>
                    </div>
                    <div id="{{this._id}}" class="findThis col-3" style="position: relative; float: right">
                        <a id="requestToAttend" onclick="requestToJoin(this)" class="btn btn-primary">Request to Attend</a>
                        <a href="#" class="btn btn-primary">{{this.date}}</a>
                        <!-- <h5 style="color: #717171; position: absolute; right: 30px; bottom: 10px">Currently: {{this.currentAttendance}} / {{this.maxAttendance}} Attendees</h5> -->
                        <i class="fas fa-check-square" style="color: green; font-size: 25px; position: absolute; top: 1px; right: 20px; width: 20px; height: 20px;"></i>
                    </div>
                </div>
            </div>
        {{/each}}
    </div>

    <div id="applied" style="display: none">
        {{#each eventsApplied}}
            <div class="card shadow" style="width: 100%; margin-top: 10px; display: inline-block; margin-bottom: 10px;">
                <div class="row">
                    <div class="col-3" style="float: left; padding-left: 0px; padding-right: 0px">
                        <img class="card-img-top" src={{this.image}} alt="Card image cap" style="width: 100%; height: 100%;">
                    </div>
                    <div class="col-6" >
                        <div class="card-body" style="padding: 0px; float: left">
                            <h5 class="card-title">{{this.name}}</h5>
                            <p class="card-text">{{this.description}}</p>
                        </div>
                    </div>
                    <div id="{{this._id}}" class="findThis col-3" style="position: relative; float: right">
                        <a id="requestToAttend" onclick="requestToJoin(this)" class="btn btn-primary" disabled>Request to Attend</a>
                        <!-- <a href="#" class="btn btn-primary">{{this.date}}</a> -->
                        <h5 style="color: #717171; position: absolute; right: 30px; bottom: 10px">Currently: {{this.currentAttendance}} / {{this.maxAttendance}} Attendees</h5>
                        <i class="fas fa-check-square" style="color: #ffc107; font-size: 25px; position: absolute; top: 1px; right: 20px; width: 20px; height: 20px;"></i>
                    </div>
                </div>
            </div>
        {{/each}}
    </div>

    <div id="all">
        {{#each allEvents}}
            <div class="card shadow" style="width: 100%; margin-top: 10px; display: inline-block; margin-bottom: 10px;">
                <div class="row">
                    <div class="col-3 text-center" style="float: left; padding-left: 0px; padding-right: 0px">
                        <img class="card-img-top" src={{this.image}} alt="Card image cap" style="width: 80%; height: 80%;">
                    </div>
                    <div id="{{this._id}}" class="findThis col-9" >
                        <div class="card-body" style="padding: 0px; float: left">
                            <h4 class="card-title">{{this.name}}</h4>
                            <h5 class="card-title" style="margin-top: -18px; color: #717171">{{this.date}}</h5>
                            <p class="card-text">{{this.description}}</p>
                            <br>
                            <br>
                            <div class="row">
                                <a id="requestToAttend" onclick="requestToJoin(this)" style="font-weight: bold; border-color: #02a6ff; background-color: #02a6ff; color: white; position: absolute; left: 15px; bottom: 15px" class="btn btn-primary">Request to Attend</a>
                                <h5 style="color: #717171; position: absolute; right: 30px; bottom: 10px">Currently: {{this.attending.length}} / {{this.maxAttendance}} Attendees</h5>
                                <i class="fas fa-check-square" style="color: blue; font-size: 25px; position: absolute; top: 1px; right: 20px; width: 20px; height: 20px;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {{/each}}
    </div>
</div>

<div class="col-3" style="float: right; text-align: center; position: fixed; right: 0px; height: 100%; background-color: #00e9ff;  display: block;">
    <img class="shadow-sm" src="images/Profile.png" style="width:60%; margin-left:5%; border-radius: 60%; margin-top: 5%">
    <h3 style="color:white; text-shadow: 2px 4px 3px rgba(0,0,0,0.3);">{{username}}</h3>
<br><br>
        <div id="bioDiv">
    {{#if bio}}
        <h5 id="bio" class="sideBarText">{{bio}}</h5>
    {{else}}
        <h5 id="bio" class="sideBarText">Have something you want to share in your bio? Click to edit</h5>
    {{/if}}
        </div>

<div id="faveDiv">
    {{#if fave}}
        <h7 id="fave" class="sideBarText">Favorite Food: {{fave}}</h7>
    {{else}}
        <h7 id="fave" class="sideBarText">Click here to add your favorite food!</h7>
    {{/if}}
</div>

    <br><br>

    <a onclick="toggleDisplay('owned')" style=" height:13%; background-image:     linear-gradient(
      rgba(0, 233, 255, 0.45),
      rgba(2, 166, 255, 0.45)
    ), url(images/FishPic.jpg); background-size: cover; margin-bottom:5px; border-radius: 10px; cursor:pointer; color:white; font-size: 50px; text-shadow: 2px 4px 3px rgba(0,0,0,0.3);">
        My Events
    </a>
    <a onclick="toggleDisplay('attending')" style=" height:13%; background-image:     linear-gradient(
      rgba(0, 233, 255, 0.45),
      rgba(2, 166, 255, 0.45)
    ), url(images/FishPic.jpg); background-size: cover; margin-bottom:5px; border-radius: 10px; cursor:pointer; color:white; font-size: 50px; text-shadow: 2px 4px 3px rgba(0,0,0,0.3);">
        Accepted
    </a>
    <a onclick="toggleDisplay('applied')" style=" height:13%; background-image:     linear-gradient(
      rgba(0, 233, 255, 0.45),
      rgba(2, 166, 255, 0.45)
    ), url(images/FishPic.jpg); background-size: cover; margin-bottom:5px; border-radius: 10px; cursor:pointer; color:white; font-size: 50px; text-shadow: 2px 4px 3px rgba(0,0,0,0.3);">
        Pending
    </a>
</div>

<div id="modaling" class="modal">
    <form class="modal-content animate">
      <div style="font-style:italic" class="container">

      	<p id="modal-name"> </p>
      	<p id="modal-email"> </p>
      	<p id="modal-bio"> </p>
      	<p id="modal-fave"> </p>
        
       

      </div>

    </form>
  </div>


</body>

<style>
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 50;
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
  padding-top: 60px;
}

.modal-content {
  border-radius: 1em;
  background-color: lightblue;
  margin: 5px auto; /* 15% from the top and centered */
  border: 1px solid #888;
  width: 50%; /* Could be more or less, depending on screen size */
}

.animate {
  -webkit-animation: animatezoom 0.6s;
  animation: animatezoom 0.6s
}

@-webkit-keyframes animatezoom {
  from {-webkit-transform: scale(0)}
  to {-webkit-transform: scale(1)}
}

@keyframes animatezoom {
  from {transform: scale(0)}
  to {transform: scale(1)}
}
</style>
<script>

    $(document).ready(function() {
        var originalBio = $('#bio');
        var originalFave = $('#fave');
        var inputBio = $('<input />', {
            'type': 'text',
            'placeholder': originalBio.text(),
            'id': 'inputBio'
        });
        var inputFave = $('<input />', {
            'type': 'text',
            'placeholder': originalFave.text(),
            'id': 'inputFave'
        });

        $('#bioDiv').on('click', '#bio', function () {
            $('#bio').replaceWith(inputBio);
            //$('#inputBio').replaceWith(originalElement);
            $('#bioDiv').find('#inputBio').on('focusout', function () {
                //var isChanged = false;
                if($('#inputBio').val()){
                    originalBio.text($('#inputBio').val());
                    //isChanged = true;
                    $.ajax({
                        url: '/main/changeBioFave',
                        type: 'post',
                        data: {
                            bio: $('#inputBio').val()
                        },
                        success: function (response) {
                            alert("Successfully added new Bio");
                        },
                        error: function (e) {
                            console.log(e);
                        }
                    }).then($('#inputBio').replaceWith(originalBio));

                }
            })
        });


        $('#faveDiv').on('click', '#fave', function () {
            $('#fave').replaceWith(inputFave);
            //$('#inputBio').replaceWith(originalElement);
            $('#faveDiv').find('#inputFave').on('focusout', function () {
                //var isChanged = false;
                if($('#inputFave').val()){
                    originalFave.text($('#inputFave').val());
                    //isChanged = true;
                    $.ajax({
                        url: '/main/changeBioFave',
                        type: 'post',
                        data: {
                            fave: $('#inputFave').val()
                        },
                        success: function (response) {
                            alert("Successfully added new Favorito");
                        },
                        error: function () {
                            alert("Changing Event failed");
                        }
                    }).then($('#inputFave').replaceWith(originalFave));

                }
            })
        });
    });

function toggleDisplay(id) {
    var div = document.getElementById(id);
    console
    if (div.style.display === "none") {
        div.style.display = "block";
    } else {
        div.style.display = "none";
    }
}

function goToCreate() {
	window.location.href = 'createevent', true;
}

function requestToJoin(e) {
    var joinThis = $(e).closest(".findThis").attr('id');
    $.ajax({
        url: '/main/requestEvent',
        type: 'post',
        data: {
            eventId: joinThis
        },
        success: function (response) {
            alert("Successfully requested to join. You probably hate seeing events so uhh Chris make this pretty plox?");
            location.reload();
        },
        error: function () {

            alert("Requesting to join event failed");
        }
    });
}
function showModal(user) {
	//Populate the fields inside the modal
	document.getElementById('modal-name').innerHTML = "Username: "+user.name;
	document.getElementById('modal-email').innerHTML = "Email: "+ user.email;
	if (user.bio == null) {
		document.getElementById('modal-bio').innerHTML = "This user does not have any bio";
	}
	else document.getElementById('modal-bio').innerHTML = "About: "+ user.bio;
	if (user.fave == null) {
		document.getElementById('modal-fave').innerHTML = "This user doesn't have any favorite food"
	}
	else document.getElementById('modal-fave').innerHTML = "Favorite food: "+ user.fave;			
	var modal = document.getElementById('modaling')
	modal.style.display='block'
    //var userId = button.id;
    //var eventId = $(button).closest(".eventId").attr('id');

    //var modal = document.getElementById('modaling');
    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    };
}

function acceptRequest(button) {
    var userId = button.id;
    var eventId = $(button).closest(".eventId").attr('id');

    $.ajax({
        url: '/main/acceptRequest',
        type: 'post',
        data: {
            userId: userId,
            eventId: eventId
        },
        success: function (response) {
            alert("Successfully accepted user.");
            location.reload();
        },
        error: function () {
            alert("Accepting user failed");
        }
    });
}


function declineRequest(button) {
    var userId = button.id;
    var eventId = $(button).closest(".eventId").attr('id');

    $.ajax({
        url: '/main/declineRequest',
        type: 'delete',
        data: {
            userId: userId,
            eventId: eventId
        },
        success: function (response) {
            alert("Successfully declined user.");
            location.reload();
        },
        error: function () {
            alert("Declining user failed");
        }
    });
}
</script>
